
### Feature-First ＋ Clean Architecture + MVVM

機能ごとの独立性を保ち、テストしやすくメンテナンス性の高いコードベースを目指します。

---
### **全体構成図**

```
lib/
├── core/                    # アプリの基盤となる共通機能（非UI層）
│   ├── di/                  # 依存性注入 (Dependency Injection) の設定
│   ├── errors/              # エラーハンドリング、Failureクラス
│   ├── network/             # Dioインスタンスなどのネットワーク設定
│   ├── theme/               # アプリのテーマ設定
│   └── utils/               # 汎用的な便利ツール
│
├── data/                  　# データ層 (どうやってデータを取得・保存するか)
│   ├── datasources/         # データの源泉 (API, Local DBなど)
│   │   └── remote/          # リモートデータソース (API)
│   │       └── api_client.dart
│   ├── models/              # データソース固有のモデル (JSONのシリアライズ用など)
│   └── repositories/        # Repositoryインターフェースの実装
│
├── domain/                  # ドメイン層 (このアプリが何をするか)
│   ├── entities/            # アプリの核となるビジネスオブジェクト
│   ├── repositories/        # データ操作のインターフェース (抽象)
│   └── usecases/            # アプリのビジネスロジック (ユースケース)
│
├── features/                # 機能層 (UIと、UIを制御するロジック)
│   ├── onboarding/          # オンボーディング機能
│   │   └── presentation/
│   │       ├── view_model.dart   # ViewModel
│   │       ├── view.dart         # 各画面のView
│   │       └── widgets/     # その画面でのみ使うWidget
│   ├── video_editor/        # 動画編集機能
│   └── account/             # アカウント関連機能
│
├── shared/                  # 共有のUI層
│   ├── providers/           # アプリ全体で共有する状態 (認証などUIを制御する状態など)
│   └── widgets/             # 複数の機能で再利用する共通Widget (ボタン、ダイアログなど)
│
└── main.dart                # アプリケーションのエントリーポイント
```

---

### **各ディレクトリの役割**

#### **`features` (機能層)** 🎨

- **役割**: アプリの各機能を配置します。「オンボーディング」「動画編集」のように、ユーザーに見える機能単位でディレクトリを分割します。
- **特徴**: 各機能は原則として他の機能から独立しています。これにより、担当機能に集中でき、並行開発がしやすくなります。
- **内部構成**: `presentation`ディレクトリを持ち、UIに関連する`screens` (View) と `view_models` (ViewModel) を配置します。
    

#### **`domain` (ドメイン層)** 🧠

- **役割**: **「このアプリが何をするか」** というビジネスルールを定義します。ここはプロジェクトの心臓部であり、フレームワークやUIから完全に独立した純粋なDartコードで記述します。
- **`entities`**: アプリケーションの核となるデータ構造です。（例: `User`, `VideoTemplate`）
- **`repositories`**: データがどこから来るか（API or DB）を隠蔽するためのインターフェース（設計図）を定義します。（例: `abstract class UserRepository { ... }`）
- **`usecases`**: 「オンボーディングの回答を送信する」といった、特定のビジネスフローを実現するクラスです。`ViewModel`からの指示を受け、`Repository`を介して処理を実行します。
    

#### **`data` (データ層)** 🔌

- **役割**: **「どうやってデータを取得・保存するか」** を具体的に実装します。`domain`層で定義された`Repository`インターフェースを実装する場所です。
- **`datasources`**: APIとの通信、ローカルデータベースへのアクセスなど、データの源泉となる処理を記述します。バックエンドとのやり取りはここが担当します。
- **`models`**: APIのレスポンス（JSON）をDartオブジェクトに変換するためのクラスなど、データソース固有のデータ構造を定義します。
- **`repositories`**: `domain`層の`Repository`インターフェースを実装した具象クラスを配置します。
    

#### **`shared` (共有UI層)** ♻️

- **役割**: 複数の`feature`で共通して使われるUIコンポーネント（カスタムボタン、ローディングインジケーターなど）や、アプリ全体で共有したい状態（認証情報など）を管理する`Provider`を配置します。
    

#### **`core` (コア層)** ⚙️

- **役割**: アプリケーション全体の基盤となる機能を配置します。特定の機能には依存しない、横断的な関心事を扱います。
- **例**: DI（依存性注入）の設定、エラーハンドリングの仕組み、ネットワーククライアントの初期化、定数、テーマなど。
    

---

### **データの流れ**

**`View` → `ViewModel` → `UseCase` → `Repository(I/F)`** `...` **`Repository(Impl)` → `DataSource` → `Backend API`**